name: Auto Promote Branches

on:
  push:
    branches:
      - editing

jobs:
  promote:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Set git identity
        run: |
          git config --global user.email "actions@github.com"
          git config --global user.name "GitHub Actions Bot"

      - name: Promote editing → staging
        run: |
          git fetch origin
          git checkout -B staging origin/staging
          git merge origin/editing --no-ff -m "Auto-promote editing → staging"
          git push origin staging

      - name: Create or update PR for staging → main
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          base: main
          branch: staging
          title: "Promote staging to main"
          body: "Automated promotion from staging to main"
          labels: auto-promotion
