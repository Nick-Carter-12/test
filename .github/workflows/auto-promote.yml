name: Auto Promote Branches

on:
  push:
    branches:
      - editing

jobs:
  promote:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # 1. Promote editing -> staging (fast-forward merge or regular merge)
      - name: Promote editing to staging
        run: |
          git fetch origin

          git switch staging || git switch -c staging origin/staging
          git merge origin/editing --no-edit

          git push origin staging

      # 2. Auto-create or update PR from staging -> main
      - name: Create or update PR for staging â†’ main
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          branch: staging
          base: main
          title: "Promote staging to main"
          body: |
            Automated PR created because updates reached staging.
            Please review and merge when ready.
          draft: false
          update-existing: true
